version: '3'

# ğŸŸ¢ 1. å°†å˜é‡å®šä¹‰ç§»åŠ¨åˆ°è¿™é‡Œ (å…¨å±€å˜é‡)
vars:
  BINARY_NAME: '{{if eq OS "windows"}}quell.exe{{else}}quell{{end}}'

tasks:
  default:
    cmds:
      - task: run

  run:
    desc: ç›´æ¥ç¼–è¯‘å¹¶è¿è¡Œä»£ç  (å¼€å‘ç”¨ - æ…¢)
    cmds:
      - go run ./cmd/quell/main.go

  build:
    desc: ç¼–è¯‘ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶åˆ° bin ç›®å½•
    cmds:
      # è¿™é‡Œçš„ {{.BINARY_NAME}} ç°åœ¨èƒ½æ­£ç¡®è¯»å–äº†
      - cmd: echo "Building {{.BINARY_NAME}}..."
      - cmd: go build -o bin/{{.BINARY_NAME}} ./cmd/quell/main.go
      - cmd: echo "Build success! Output! bin/{{.BINARY_NAME}}"

  exec:
    desc: ç›´æ¥è¿è¡Œ bin ç›®å½•ä¸‹çš„ exe (éœ€å…ˆ build - å¿«)
    # ä¾èµ–æ£€æŸ¥ï¼šç¡®ä¿æ–‡ä»¶å­˜åœ¨ï¼Œå¦åˆ™å…ˆè‡ªåŠ¨è¿è¡Œ build
    deps: [build]
    cmds:
      # Windows PowerShell å…¼å®¹å†™æ³•
      - powershell -Command "./bin/{{.BINARY_NAME}}"

  clean:
    desc: åˆ é™¤æ„å»ºäº§ç‰©
    cmds:
      - cmd: rm -rf bin/
      - cmd: echo "Cleaned."
    ignore_error: true